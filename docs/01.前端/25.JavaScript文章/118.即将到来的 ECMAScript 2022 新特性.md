# 即将到来的 ECMAScript 2022 新特性

ECMAScript 规范每年都会更新一次，正式标准化 JavaScript 语言的 ECMAScript 的下一次年度更新将在 2022 年 6 月左右获得批准。自 2015 年以来，TC39 团队成员每年都会一起讨论可用的提案，并发布已接受的提案。今年是 ECMAScript 的第 13 版，其中包括许多实用的功能。所有在 2022 年 3 月之前达到阶段 4 的提案都将包含在全新的 ECMAScript 2022 标准中。

## 对于一个提案，从提出到最后被纳入ES新特性，TC39的规范中分为五步：

- stage0（strawman），任何TC39的成员都可以提交。
- stage1（proposal），进入此阶段就意味着这一提案被认为是正式的了，需要对此提案的场景与API进行详尽的描述。
- stage2（draft），演进到这一阶段的提案如果能最终进入到标准，那么在之后的阶段都不会有太大的变化，因为理论上只接受增量修改。
- state3（candidate），这一阶段的提案只有在遇到了重大问题才会修改，规范文档需要被全面的完成。
- state4（finished），这一阶段的提案将会被纳入到ES每年发布的规范之中

目前，一些提案还处于第三阶段，一些提案已经进入第四阶段。提案的功能将在达到第 4 阶段后被添加到新的ECMAScript标准中，这意味着它们已获得 TC-39 的批准，通过了测试，并且至少有两个实现。下面就来看看 ECMAScript 2022 预计会推出的新功能吧~

# 一、Top-level Await

在ES2017中引入了 async 函数和 await 关键字，以简化 Promise 的使用，但是 await 关键字只能在 async 函数内部使用。尝试在异步函数之外使用 await 就会报错：SyntaxError - SyntaxError: await is only valid in async function。

顶层 await 允许我们在 async 函数外面使用 await 关键字，目前提案正处于第 4 阶段，并且已经在三个主要的浏览器的 JavaScript 引擎中实现，模块系统会协调所有的异步 promise。

顶层 await 允许模块充当大型异步函数，通过顶层 await，这些ECMAScript模块可以等待资源加载。这样其他导入这些模块的模块在执行代码之前要等待资源加载完再去执行。下面来看一个简单的例子。